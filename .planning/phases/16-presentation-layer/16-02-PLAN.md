---
phase: 16-presentation-layer
plan: 02
type: execute
wave: 2
depends_on: ["16-01"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "ClassTaskPresenter segregates tasks into open/completed columns"
    - "ClassTaskPresenter shows 'Open +N' badge format"
    - "Agent Order Number task shows note_required validation"
    - "User can see all classes in dashboard including those with no events"
    - "User can complete open tasks via Complete button"
    - "User can reopen completed tasks via Reopen button"
    - "Badge updates correctly after task status change"
    - "Search and filter functionality works"
  artifacts: []
  key_links:
    - from: "ClassTaskPresenter::presentTasks()"
      to: "View template open_tasks/completed_tasks arrays"
      via: "PHP array segregation"
    - from: "ClassTaskPresenter::formatTaskStatusBadge()"
      to: "Badge display in view"
      via: "'Open +N' format string"
    - from: "Complete button click"
      to: "Task moves to Completed column"
      via: "AJAX POST to TaskController"
    - from: "Reopen button click"
      to: "Task moves to Open column"
      via: "AJAX POST to TaskController"
---

<objective>
Verify the presentation layer works correctly with event-based task system, including ClassTaskPresenter formatting logic and UI interactions.

Purpose: Confirm UI-01 (ClassTaskPresenter formats event-based tasks), UI-02, UI-03 requirements are satisfied after code changes in Plan 16-01.

Output: Verified working UI with presenter logic confirmed, ready for Phase 17 code cleanup.
</objective>

<execution_context>
@/home/laudes/.claude/get-shit-done/workflows/execute-plan.md
@/home/laudes/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-presentation-layer/16-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify ClassTaskPresenter output format (UI-01)</name>
  <files>tests/Events/Presenters/ClassTaskPresenterTest.php</files>
  <action>
  Run existing ClassTaskPresenter tests to verify presenter logic works correctly:

  ```bash
  ./vendor/bin/phpunit tests/Events/Presenters/ClassTaskPresenterTest.php
  ```

  If tests don't exist, create a simple verification by grepping the presenter output structure:

  1. Confirm presentTasks() returns array with 'open_tasks' and 'completed_tasks' keys
  2. Confirm formatTaskStatusBadge() returns "Open +N" format
  3. Confirm Agent Order Number task has note_required=true and note_placeholder set

  The presenter was updated in Phase 14 and should already work. This task confirms via code inspection or test run.
  </action>
  <verify>
  Either:
  - PHPUnit tests pass for ClassTaskPresenter, OR
  - Manual grep confirms presentTasks() segregates by status and formatTaskStatusBadge() uses "Open +" format
  </verify>
  <done>
  ClassTaskPresenter formatting verified: tasks segregated into open/completed, badge shows "Open +N" format, Agent Order Number has note_required.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
  Event-based task dashboard with:
  - ClassTaskPresenter formatting event-based tasks (UI-01):
    * Tasks segregated into Open Tasks / Completed Tasks columns
    * Badge shows "Open +N" format
    * Agent Order Number task requires note input
  - JavaScript AJAX using class_id parameter (from 16-01)
  - View templates without obsolete log_id references (from 16-01)
  </what-built>
  <how-to-verify>
  **Part A: Presenter Logic Verification (UI-01)**
  1. Navigate to Event Tasks dashboard
  2. Expand a class with both open and completed tasks
  3. Verify:
     a. Open tasks appear in left column under "Open Tasks"
     b. Completed tasks appear in right column under "Completed Tasks"
     c. Badge on collapsed row shows "Open +N" (e.g., "Open +2" for 2 open tasks)
  4. Find a class with Agent Order Number task
  5. Verify:
     a. Agent Order Number task shows text input field (not just optional note)
     b. Placeholder text says "Enter Agent Order Number"
     c. Cannot complete without entering value (validation)

  **Part B: Task Operations Verification (UI-02, UI-03)**
  6. Test task completion:
     a. For a regular event task: enter optional note, click Complete
     b. Verify task moves to Completed column with user/timestamp
     c. Verify badge updates from "Open +N" to "Open +(N-1)"
  7. Test Agent Order Number completion:
     a. Try to complete without entering order number - should show validation error
     b. Enter order number, click Complete
     c. Verify task moves to Completed column
  8. Test task reopen:
     a. Click Reopen on a completed task
     b. Verify task moves back to Open column
     c. For Agent Order: verify notes preserved on reopen

  **Part C: General Functionality**
  9. Verify all classes appear (including those with no events - they show Agent Order Number task)
  10. Test search/filter functionality
  11. Check browser console for JavaScript errors (should be none)

  Expected behavior:
  - Presenter correctly formats tasks into open/completed segregation
  - Badge format is "Open +N" (not old format)
  - All AJAX operations succeed (no 400/500 errors)
  - Tasks move between columns instantly
  </how-to-verify>
  <resume-signal>Type "approved" if all tests pass, or describe specific issues encountered</resume-signal>
</task>

</tasks>

<verification>
Task 1 (automated):
- [ ] ClassTaskPresenter test passes OR code inspection confirms logic

User manually verifies:
- [ ] Tasks segregated into Open/Completed columns (UI-01)
- [ ] Badge shows "Open +N" format (UI-01)
- [ ] Agent Order Number task requires note input (UI-01)
- [ ] All classes visible in dashboard (UI-02)
- [ ] Complete button works for regular tasks (UI-02)
- [ ] Complete button requires order number for Agent Order task (UI-02)
- [ ] Reopen button works (UI-03)
- [ ] Badge updates correctly (UI-02/03)
- [ ] Search/filter works
- [ ] No JavaScript errors
</verification>

<success_criteria>
- UI-01: ClassTaskPresenter formats event-based tasks correctly (segregation, badges, Agent Order)
- UI-02: Task completion works (regular and Agent Order Number)
- UI-03: Task reopen works with note preservation
- No console errors during task operations
- User confirms "approved"
</success_criteria>

<output>
After completion, create `.planning/phases/16-presentation-layer/16-02-SUMMARY.md`
</output>
