---
phase: 16-presentation-layer
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/Events/Shortcodes/EventTasksShortcode.php
  - views/events/event-tasks/main.php
autonomous: true

must_haves:
  truths:
    - "AJAX task completion sends class_id parameter"
    - "View templates do not reference log_id"
    - "Task dashboard loads without JavaScript errors"
  artifacts:
    - path: "src/Events/Shortcodes/EventTasksShortcode.php"
      provides: "JavaScript AJAX handler with class_id parameter"
      contains: "formData.append('class_id'"
    - path: "views/events/event-tasks/main.php"
      provides: "Task panel view without data-log-id attributes"
      contains: "data-class-id"
  key_links:
    - from: "EventTasksShortcode.php JavaScript"
      to: "TaskController::handleTaskUpdate()"
      via: "AJAX POST with class_id"
      pattern: "class_id.*panel\\.dataset\\.classId"
---

<objective>
Fix JavaScript AJAX parameter and clean up obsolete view attributes for event-based task system.

Purpose: Enable Complete/Reopen buttons to work with refactored TaskController that expects class_id (Phase 15-02 change). Remove confusing data-log-id attributes that are no longer used.

Output: Working AJAX task operations, clean view templates.
</objective>

<execution_context>
@/home/laudes/.claude/get-shit-done/workflows/execute-plan.md
@/home/laudes/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-presentation-layer/16-RESEARCH.md

# Key context from prior phases
@.planning/phases/15-bidirectional-sync/15-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix JavaScript AJAX parameter from log_id to class_id</name>
  <files>src/Events/Shortcodes/EventTasksShortcode.php</files>
  <action>
  In the inline JavaScript within EventTasksShortcode.php, locate the formData.append call around line 585:

  BEFORE:
  ```javascript
  formData.append('log_id', panel.dataset.logId || '');
  ```

  AFTER:
  ```javascript
  formData.append('class_id', panel.dataset.classId || '');
  ```

  This change aligns with TaskController which now expects class_id parameter (implemented in Phase 15-02).

  The panel.dataset.classId is already present in the view (data-class-id attribute exists).
  </action>
  <verify>
  Grep for 'log_id' in EventTasksShortcode.php - should return 0 matches.
  Grep for 'class_id' in EventTasksShortcode.php formData section - should show the new append call.
  </verify>
  <done>
  JavaScript AJAX handler sends class_id instead of log_id to TaskController.
  </done>
</task>

<task type="auto">
  <name>Task 2: Remove obsolete data-log-id attributes from view template</name>
  <files>views/events/event-tasks/main.php</files>
  <action>
  Remove the data-log-id attributes from main.php. There are 2 occurrences:

  1. Line ~141 - On the table row (tr) element:
     BEFORE: data-log-id="<?php echo esc_attr((string) ($class['log_id'] ?? '')); ?>"
     AFTER: (remove entire line)

  2. Line ~203 - On the wecoza-task-panel-content div:
     BEFORE: data-log-id="<?php echo esc_attr((string) ($class['log_id'] ?? '')); ?>"
     AFTER: (remove from the attributes list)

  Keep data-class-id - it's actively used by JavaScript.

  The log_id is obsolete because class_change_logs table was dropped in Phase 13.
  </action>
  <verify>
  Grep for 'data-log-id' in views/events/event-tasks/main.php - should return 0 matches.
  Grep for 'data-class-id' - should still show 2+ matches (preserved).
  </verify>
  <done>
  View templates reference only class_id, no mentions of log_id in data attributes.
  </done>
</task>

</tasks>

<verification>
1. `grep -r "log_id" src/Events/Shortcodes/EventTasksShortcode.php` returns no matches
2. `grep -r "data-log-id" views/events/event-tasks/main.php` returns no matches
3. `grep -r "data-class-id" views/events/event-tasks/main.php` returns 2+ matches
4. `grep -r "class_id" src/Events/Shortcodes/EventTasksShortcode.php` shows formData.append line
</verification>

<success_criteria>
- JavaScript sends class_id to TaskController (not log_id)
- View templates have no data-log-id attributes
- data-class-id attributes preserved and functional
- No PHP syntax errors in modified files
</success_criteria>

<output>
After completion, create `.planning/phases/16-presentation-layer/16-01-SUMMARY.md`
</output>
