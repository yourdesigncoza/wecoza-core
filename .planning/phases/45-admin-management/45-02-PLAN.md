---
phase: 45-admin-management
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/Learners/Shortcodes/progression-admin-shortcode.php
  - views/learners/progression-admin.php
  - wecoza-core.php
autonomous: true
requirements: [ADMIN-01, ADMIN-04]

must_haves:
  truths:
    - "Shortcode [wecoza_progression_admin] renders a filterable admin table of all progressions"
    - "Filter row has dropdowns for client, class, LP/product, and status"
    - "Table shows columns: checkbox, learner name, LP/product, class, client, status badge, progress%, start date, actions"
    - "Each row has an actions dropdown with: View Hours Log, Hold/Resume, Mark Complete"
    - "Bulk action bar appears with checkbox selection and Bulk Complete button"
    - "Start New LP button opens a modal form with learner select, product select, optional class, notes"
  artifacts:
    - path: "src/Learners/Shortcodes/progression-admin-shortcode.php"
      provides: "Shortcode registration and script/style enqueue"
      contains: "wecoza_progression_admin"
    - path: "views/learners/progression-admin.php"
      provides: "Full admin table HTML with filters, bulk bar, modals"
      contains: "progression-admin-table"
    - path: "wecoza-core.php"
      provides: "require_once for new shortcode file"
      contains: "progression-admin-shortcode.php"
  key_links:
    - from: "src/Learners/Shortcodes/progression-admin-shortcode.php"
      to: "views/learners/progression-admin.php"
      via: "wecoza_view() or include"
      pattern: "progression-admin"
    - from: "views/learners/progression-admin.php"
      to: "assets/js/learners/progression-admin.js"
      via: "wp_enqueue_script in shortcode"
      pattern: "progression-admin"
---

<objective>
Create the `[wecoza_progression_admin]` shortcode with a full-featured admin view: filterable table with checkboxes, bulk action bar, action dropdowns per row, Start New LP modal, and Hours Log modal.

Purpose: Provides the HTML shell and shortcode registration that Plan 03's JS will wire up.
Output: Shortcode file, view template, wecoza-core.php registration.
</objective>

<execution_context>
@/home/laudes/.claude/get-shit-done/workflows/execute-plan.md
@/home/laudes/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/Learners/Shortcodes/learners-display-shortcode.php (pattern reference)
@src/Learners/Services/ProgressionService.php
@src/Learners/Enums/ProgressionStatus.php
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create shortcode file and view template</name>
  <files>
    src/Learners/Shortcodes/progression-admin-shortcode.php
    views/learners/progression-admin.php
  </files>
  <action>
**Shortcode file** (`src/Learners/Shortcodes/progression-admin-shortcode.php`):

Follow the exact pattern from `learners-display-shortcode.php`:
- Namespace: `WeCoza\Learners\Shortcodes`
- Function: `wecoza_progression_admin_shortcode()`
- Enqueue JS: `progression-admin-script` pointing to `assets/js/learners/progression-admin.js` with dependency on `jquery`.
- `wp_localize_script` with variable name `progressionAdminAjax` containing:
  - `ajaxurl` => `admin_url('admin-ajax.php')`
  - `nonce` => `wp_create_nonce('learners_nonce')`
- Output buffer: `ob_start()`, include the view file, return `ob_get_clean()`.
- Register: `add_shortcode('wecoza_progression_admin', __NAMESPACE__ . '\wecoza_progression_admin_shortcode');`

**View template** (`views/learners/progression-admin.php`):

Follow Phoenix card + table pattern from learners-display-shortcode.php. Structure:

```
<div id="progression-admin-container">
  <!-- Alert Container -->
  <div id="progression-admin-alert" class="alert-container"></div>

  <!-- Loading -->
  <div id="progression-admin-loading"> spinner... </div>

  <!-- Main Content (display:none initially, JS shows it) -->
  <div id="progression-admin-content" style="display: none;">

    <!-- Header Row: Title + Start New LP button -->
    <div class="row mb-3">
      <div class="col">
        <h4>Progression Management <i class="bi bi-mortarboard"></i></h4>
      </div>
      <div class="col-auto">
        <button id="btn-start-new-lp" class="btn btn-phoenix-primary btn-sm">
          <i class="bi bi-plus-circle me-1"></i> Start New LP
        </button>
      </div>
    </div>

    <!-- Filter Card -->
    <div class="card shadow-none border mb-3">
      <div class="card-body p-3">
        <form id="progression-filter-form" class="row g-2 align-items-end">
          <div class="col-md-3">
            <label class="form-label fs-9 mb-1">Client</label>
            <select id="filter-client" class="form-select form-select-sm">
              <option value="">All Clients</option>
            </select>
          </div>
          <div class="col-md-2">
            <label class="form-label fs-9 mb-1">Class</label>
            <select id="filter-class" class="form-select form-select-sm">
              <option value="">All Classes</option>
            </select>
          </div>
          <div class="col-md-3">
            <label class="form-label fs-9 mb-1">Learning Programme</label>
            <select id="filter-product" class="form-select form-select-sm">
              <option value="">All LPs</option>
            </select>
          </div>
          <div class="col-md-2">
            <label class="form-label fs-9 mb-1">Status</label>
            <select id="filter-status" class="form-select form-select-sm">
              <option value="">All Statuses</option>
              <option value="in_progress">In Progress</option>
              <option value="completed">Completed</option>
              <option value="on_hold">On Hold</option>
            </select>
          </div>
          <div class="col-md-2">
            <button type="submit" class="btn btn-phoenix-secondary btn-sm w-100">
              <i class="bi bi-funnel me-1"></i> Filter
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Bulk Action Bar (hidden until checkboxes selected) -->
    <div id="bulk-action-bar" class="alert alert-phoenix-info d-none mb-3 d-flex align-items-center justify-content-between">
      <span><strong id="selected-count">0</strong> progression(s) selected</span>
      <button id="btn-bulk-complete" class="btn btn-phoenix-success btn-sm">
        <i class="bi bi-check2-all me-1"></i> Bulk Complete
      </button>
    </div>

    <!-- Data Table Card -->
    <div class="card shadow-none border" data-component-card="data-component-card">
      <div class="card-body p-4 py-2">
        <div class="table-responsive">
          <table id="progression-admin-table" class="table table-hover table-sm fs-9 mb-0">
            <thead class="border-bottom">
              <tr>
                <th class="border-0 ps-3" style="width: 40px;">
                  <input type="checkbox" id="select-all-progressions" class="form-check-input">
                </th>
                <th class="border-0">Learner</th>
                <th class="border-0">Learning Programme</th>
                <th class="border-0">Class</th>
                <th class="border-0">Status</th>
                <th class="border-0">Progress</th>
                <th class="border-0">Start Date</th>
                <th class="border-0 text-end pe-3">Actions</th>
              </tr>
            </thead>
            <tbody id="progression-admin-tbody">
              <!-- JS populates rows -->
            </tbody>
          </table>
        </div>

        <!-- Pagination -->
        <div id="progression-pagination" class="d-flex justify-content-between align-items-center p-3 border-top">
          <span id="pagination-info" class="text-muted fs-9"></span>
          <nav>
            <ul id="pagination-controls" class="pagination pagination-sm mb-0"></ul>
          </nav>
        </div>
      </div>
    </div>

  </div><!-- /progression-admin-content -->

  <!-- Start New LP Modal -->
  <div class="modal fade" id="startNewLPModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Start New Learning Programme</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div id="start-lp-alert"></div>
          <form id="start-lp-form">
            <div class="mb-3">
              <label class="form-label">Learner <span class="text-danger">*</span></label>
              <select id="start-lp-learner" class="form-select" required>
                <option value="">Select Learner...</option>
              </select>
            </div>
            <div class="mb-3">
              <label class="form-label">Learning Programme <span class="text-danger">*</span></label>
              <select id="start-lp-product" class="form-select" required>
                <option value="">Select LP...</option>
              </select>
            </div>
            <div class="mb-3">
              <label class="form-label">Class (optional)</label>
              <select id="start-lp-class" class="form-select">
                <option value="">No class</option>
              </select>
            </div>
            <div class="mb-3">
              <label class="form-label">Notes (optional)</label>
              <textarea id="start-lp-notes" class="form-control" rows="2"></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-phoenix-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>
          <button type="button" id="btn-submit-start-lp" class="btn btn-phoenix-primary btn-sm">
            <i class="bi bi-play-circle me-1"></i> Start LP
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Hours Log Modal -->
  <div class="modal fade" id="hoursLogModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Hours Audit Trail</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div id="hours-log-summary" class="mb-3">
            <!-- JS fills: learner name, LP name, status badge, total hours -->
          </div>
          <div class="table-responsive">
            <table class="table table-sm fs-9">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Hours Trained</th>
                  <th>Hours Present</th>
                  <th>Source</th>
                  <th>Notes</th>
                </tr>
              </thead>
              <tbody id="hours-log-tbody">
                <!-- JS populates -->
              </tbody>
            </table>
          </div>
          <div id="hours-log-empty" class="text-center text-muted py-3 d-none">
            No hours logged yet for this progression.
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bulk Complete Confirmation Modal -->
  <div class="modal fade" id="bulkCompleteModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Confirm Bulk Complete</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <p>You are about to mark <strong id="bulk-complete-count">0</strong> progression(s) as completed.</p>
          <p class="text-warning"><i class="bi bi-exclamation-triangle me-1"></i> Note: Bulk complete does not require portfolio uploads. Individual completions with portfolios should use the learner view.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-phoenix-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>
          <button type="button" id="btn-confirm-bulk-complete" class="btn btn-phoenix-success btn-sm">
            <i class="bi bi-check2-all me-1"></i> Confirm Complete
          </button>
        </div>
      </div>
    </div>
  </div>

</div><!-- /progression-admin-container -->
```

Use Phoenix badge classes for status: `badge-phoenix-primary` (In Progress), `badge-phoenix-success` (Completed), `badge-phoenix-warning` (On Hold).

The client, class, and product filter dropdowns will be populated by JS from separate AJAX calls (existing endpoints or new lightweight ones). For now, the HTML just has the empty `<option>` placeholders.
  </action>
  <verify>
1. `php -l src/Learners/Shortcodes/progression-admin-shortcode.php` returns no syntax errors
2. `php -l views/learners/progression-admin.php` returns no syntax errors
3. `grep 'wecoza_progression_admin' src/Learners/Shortcodes/progression-admin-shortcode.php` finds the shortcode registration
  </verify>
  <done>
- Shortcode `[wecoza_progression_admin]` is registered and renders the admin view
- View contains: filter form, bulk action bar, data table with checkboxes, three modals (Start LP, Hours Log, Bulk Complete confirm)
- All HTML elements have proper IDs for JS targeting
  </done>
</task>

<task type="auto">
  <name>Task 2: Register shortcode in wecoza-core.php</name>
  <files>wecoza-core.php</files>
  <action>
Add a require_once for the new shortcode file in wecoza-core.php, after the existing learner shortcodes block (after line ~603 where learners-update-shortcode.php is loaded, before the AJAX handlers section).

Add:
```php
    // Progression admin shortcode [wecoza_progression_admin]
    require_once WECOZA_CORE_PATH .
        "src/Learners/Shortcodes/progression-admin-shortcode.php";
```

Place it after the learners-update-shortcode.php require and before the AJAX handlers section.
  </action>
  <verify>`grep 'progression-admin-shortcode' wecoza-core.php` returns the require_once line.</verify>
  <done>Shortcode file is loaded by the plugin on initialization.</done>
</task>

</tasks>

<verification>
1. `php -l src/Learners/Shortcodes/progression-admin-shortcode.php` — no errors
2. `php -l views/learners/progression-admin.php` — no errors
3. `grep 'wecoza_progression_admin' src/Learners/Shortcodes/progression-admin-shortcode.php` — found
4. `grep 'progression-admin-shortcode' wecoza-core.php` — found
</verification>

<success_criteria>
- Shortcode [wecoza_progression_admin] is registered and renders a complete admin UI shell
- Filter form has client, class, product, status dropdowns
- Table has select-all checkbox, 8 columns including Actions
- Three modals exist: Start New LP, Hours Log, Bulk Complete Confirm
- Bulk action bar shows/hides based on checkbox selection (JS wiring in Plan 03)
- Shortcode file loaded via wecoza-core.php require_once
</success_criteria>

<output>
After completion, create `.planning/phases/45-admin-management/45-02-SUMMARY.md`
</output>
