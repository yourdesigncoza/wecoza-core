# Plan 03-01: Events Module Bootstrap Integration

## Frontmatter

```yaml
wave: 1
depends_on: []
files_modified:
  - wecoza-core.php
autonomous: true
estimated_tasks: 3
```

## Objective

Register Events module in wecoza-core bootstrap so it initializes automatically when wecoza-core activates.

## Tasks

<task id="1">
<title>Add Events namespace to PSR-4 autoloader</title>
<file>wecoza-core.php</file>
<action>
Add Events namespace mapping to the $namespaces array in the spl_autoload_register callback (around line 52):

```php
'WeCoza\\Events\\' => WECOZA_CORE_PATH . 'src/Events/',
```
</action>
<verification>
```bash
wp eval "echo class_exists('\WeCoza\Events\Shortcodes\EventTasksShortcode') ? 'OK' : 'FAIL';"
```
Expected: OK
</verification>
</task>

<task id="2">
<title>Register Events module components in plugins_loaded hook</title>
<file>wecoza-core.php</file>
<action>
Add Events module initialization section after the Classes module initialization (around line 187), before the Learners Shortcodes section:

```php
// Initialize Events Module
if (class_exists(\WeCoza\Events\Shortcodes\EventTasksShortcode::class)) {
    \WeCoza\Events\Shortcodes\EventTasksShortcode::register();
}
if (class_exists(\WeCoza\Events\Shortcodes\MaterialTrackingShortcode::class)) {
    \WeCoza\Events\Shortcodes\MaterialTrackingShortcode::register();
}
if (class_exists(\WeCoza\Events\Shortcodes\AISummaryShortcode::class)) {
    \WeCoza\Events\Shortcodes\AISummaryShortcode::register();
}
if (class_exists(\WeCoza\Events\Controllers\TaskController::class)) {
    \WeCoza\Events\Controllers\TaskController::register();
}
if (class_exists(\WeCoza\Events\Controllers\MaterialTrackingController::class)) {
    \WeCoza\Events\Controllers\MaterialTrackingController::register();
}
if (class_exists(\WeCoza\Events\Admin\SettingsPage::class)) {
    \WeCoza\Events\Admin\SettingsPage::register();
}
```
</action>
<verification>
```bash
wp eval "global \$shortcode_tags; echo isset(\$shortcode_tags['wecoza_event_tasks']) ? 'OK' : 'FAIL';"
wp eval "echo has_action('wp_ajax_wecoza_events_task_update') ? 'OK' : 'FAIL';"
```
Expected: Both OK
</verification>
</task>

<task id="3">
<title>Register Events WP-CLI command</title>
<file>wecoza-core.php</file>
<action>
Add CLI command registration inside the existing WP_CLI block (around line 355, before the closing brace):

```php
// Events CLI commands
if (class_exists(\WeCoza\Events\CLI\AISummaryStatusCommand::class)) {
    \WeCoza\Events\CLI\AISummaryStatusCommand::register();
}
```
</action>
<verification>
```bash
wp wecoza ai-summary status --help 2>&1 | head -5
```
Expected: Shows command help (not "Error: 'ai-summary' is not a registered subcommand")
</verification>
</task>

## must_haves

Observable truths that must be verifiable after execution:

1. **Autoloader resolves Events classes** - `class_exists('\WeCoza\Events\...')` returns true
2. **Shortcodes registered** - `$shortcode_tags` contains 'wecoza_event_tasks', 'wecoza_material_tracking', 'wecoza_insert_update_ai_summary'
3. **AJAX handlers hooked** - `has_action('wp_ajax_wecoza_events_task_update')` returns truthy
4. **Admin settings registered** - Settings page hooks are registered (if is_admin())
5. **CLI command available** - `wp wecoza ai-summary status` recognized as valid command

## Verification Script

```bash
#!/bin/bash
echo "=== Phase 3 Verification ==="

echo -n "1. Autoloader: "
wp eval "echo class_exists('\WeCoza\Events\Shortcodes\EventTasksShortcode') ? 'OK' : 'FAIL';"

echo -n "2. Shortcode (event_tasks): "
wp eval "global \$shortcode_tags; echo isset(\$shortcode_tags['wecoza_event_tasks']) ? 'OK' : 'FAIL';"

echo -n "3. Shortcode (material_tracking): "
wp eval "global \$shortcode_tags; echo isset(\$shortcode_tags['wecoza_material_tracking']) ? 'OK' : 'FAIL';"

echo -n "4. Shortcode (ai_summary): "
wp eval "global \$shortcode_tags; echo isset(\$shortcode_tags['wecoza_insert_update_ai_summary']) ? 'OK' : 'FAIL';"

echo -n "5. AJAX (task_update): "
wp eval "echo has_action('wp_ajax_wecoza_events_task_update') ? 'OK' : 'FAIL';"

echo -n "6. AJAX (material_delivered): "
wp eval "echo has_action('wp_ajax_wecoza_mark_material_delivered') ? 'OK' : 'FAIL';"

echo -n "7. CLI command: "
wp wecoza ai-summary status --help >/dev/null 2>&1 && echo "OK" || echo "FAIL"

echo "=== Done ==="
```

## Notes

- All components use static `register()` methods (consistent with Events module design)
- No custom capabilities added (Events has no PII-sensitive operations)
- Text domain kept as 'wecoza-events' for rollback safety
- No asset enqueuing needed (shortcodes use inline JS)

---
*Plan created: 2026-02-02*
