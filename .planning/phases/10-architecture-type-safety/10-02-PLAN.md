---
phase: 10-architecture-type-safety
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/Events/Enums/SummaryStatus.php
  - src/Learners/Enums/ProgressionStatus.php
  - src/Events/Enums/TaskStatus.php
autonomous: true

must_haves:
  truths:
    - "SummaryStatus enum has PENDING, SUCCESS, FAILED cases"
    - "ProgressionStatus enum has IN_PROGRESS, COMPLETED, ON_HOLD cases"
    - "TaskStatus enum has OPEN, COMPLETED cases"
    - "All enums use tryFrom() not from() for safe validation"
  artifacts:
    - path: "src/Events/Enums/SummaryStatus.php"
      provides: "AI summary status values"
      contains: "enum SummaryStatus: string"
    - path: "src/Learners/Enums/ProgressionStatus.php"
      provides: "LP progression status values"
      contains: "enum ProgressionStatus: string"
    - path: "src/Events/Enums/TaskStatus.php"
      provides: "Task completion status values"
      contains: "enum TaskStatus: string"
  key_links:
    - from: "src/Learners/Enums/ProgressionStatus.php"
      to: "LearnerProgressionModel::status"
      via: "string values match existing database values"
      pattern: "in_progress|completed|on_hold"
---

<objective>
Create PHP 8.1 backed string enums to replace magic status strings throughout the codebase.

Purpose: Replace string literals like 'in_progress', 'completed', 'pending' with type-safe enums that provide validation, IDE autocomplete, and prevent typos. This satisfies QUAL-03.

Output: Three enum classes in appropriate module Enums/ directories.
</objective>

<execution_context>
@/home/laudes/.claude/get-shit-done/workflows/execute-plan.md
@/home/laudes/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-architecture-type-safety/10-RESEARCH.md

# Source files to understand status values
@src/Events/Services/AISummaryService.php
@src/Learners/Models/LearnerProgressionModel.php
@src/Events/Models/Task.php
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SummaryStatus enum</name>
  <files>
    src/Events/Enums/SummaryStatus.php
  </files>
  <action>
Create the Enums directory: `src/Events/Enums/`

**SummaryStatus** - based on AISummaryService status values:
- Line 72: `'success'`
- Line 81: `'failed'`
- Line 160: `'pending'`

```php
<?php
declare(strict_types=1);

namespace WeCoza\Events\Enums;

if (!defined('ABSPATH') && php_sapi_name() !== 'cli') {
    exit;
}

/**
 * AI Summary generation status values
 *
 * @since 1.1.0
 */
enum SummaryStatus: string
{
    case PENDING = 'pending';
    case SUCCESS = 'success';
    case FAILED = 'failed';

    /**
     * Human-readable label for display
     */
    public function label(): string
    {
        return match($this) {
            self::PENDING => 'Pending',
            self::SUCCESS => 'Success',
            self::FAILED => 'Failed',
        };
    }

    /**
     * Check if status indicates completion (success or failure)
     */
    public function isTerminal(): bool
    {
        return $this !== self::PENDING;
    }

    /**
     * Safe conversion from string with fallback
     *
     * @param string|null $value Database or user input value
     * @param self $default Fallback if value is invalid
     */
    public static function tryFromString(?string $value, self $default = self::PENDING): self
    {
        if ($value === null) {
            return $default;
        }
        return self::tryFrom($value) ?? $default;
    }
}
```

**IMPORTANT:** Use `tryFrom()` not `from()` to avoid ValueError on invalid input.
  </action>
  <verify>
```bash
php -l src/Events/Enums/SummaryStatus.php
php -r "
require_once 'vendor/autoload.php';
use WeCoza\Events\Enums\SummaryStatus;
\$s = SummaryStatus::SUCCESS;
echo \$s->value . ' = ' . \$s->label() . PHP_EOL;
echo SummaryStatus::tryFromString('invalid', SummaryStatus::PENDING)->value . PHP_EOL;
"
```
  </verify>
  <done>SummaryStatus enum exists with PENDING/SUCCESS/FAILED cases, label() method, and tryFromString() safe conversion</done>
</task>

<task type="auto">
  <name>Task 2: Create ProgressionStatus enum</name>
  <files>
    src/Learners/Enums/ProgressionStatus.php
  </files>
  <action>
Create the Enums directory: `src/Learners/Enums/`

**ProgressionStatus** - based on LearnerProgressionModel (lines 61-62, 202-221):
- `'in_progress'` - LP currently active
- `'completed'` - LP finished successfully
- `'on_hold'` - LP paused

```php
<?php
declare(strict_types=1);

namespace WeCoza\Learners\Enums;

if (!defined('ABSPATH') && php_sapi_name() !== 'cli') {
    exit;
}

/**
 * Learner LP Progression status values
 *
 * Constraint: Only ONE 'in_progress' LP per learner at a time.
 *
 * @since 1.1.0
 */
enum ProgressionStatus: string
{
    case IN_PROGRESS = 'in_progress';
    case COMPLETED = 'completed';
    case ON_HOLD = 'on_hold';

    /**
     * Human-readable label for display
     */
    public function label(): string
    {
        return match($this) {
            self::IN_PROGRESS => 'In Progress',
            self::COMPLETED => 'Completed',
            self::ON_HOLD => 'On Hold',
        };
    }

    /**
     * CSS class for badge styling
     */
    public function badgeClass(): string
    {
        return match($this) {
            self::IN_PROGRESS => 'badge-primary',
            self::COMPLETED => 'badge-success',
            self::ON_HOLD => 'badge-warning',
        };
    }

    /**
     * Check if learner is actively learning
     */
    public function isActive(): bool
    {
        return $this === self::IN_PROGRESS;
    }

    /**
     * Check if LP allows hour logging
     */
    public function canLogHours(): bool
    {
        return $this === self::IN_PROGRESS;
    }

    /**
     * Safe conversion from string with fallback
     */
    public static function tryFromString(?string $value, self $default = self::IN_PROGRESS): self
    {
        if ($value === null) {
            return $default;
        }
        return self::tryFrom($value) ?? $default;
    }
}
```
  </action>
  <verify>
```bash
php -l src/Learners/Enums/ProgressionStatus.php
php -r "
require_once 'vendor/autoload.php';
use WeCoza\Learners\Enums\ProgressionStatus;
foreach (ProgressionStatus::cases() as \$case) {
    echo \$case->value . ' -> ' . \$case->label() . PHP_EOL;
}
"
```
  </verify>
  <done>ProgressionStatus enum exists with IN_PROGRESS/COMPLETED/ON_HOLD cases, helper methods for badge styling and hour logging permission</done>
</task>

<task type="auto">
  <name>Task 3: Create TaskStatus enum and verify all enums</name>
  <files>
    src/Events/Enums/TaskStatus.php
  </files>
  <action>
**TaskStatus** - based on Task.php model patterns:
- `'open'` - Task pending completion
- `'completed'` - Task done

```php
<?php
declare(strict_types=1);

namespace WeCoza\Events\Enums;

if (!defined('ABSPATH') && php_sapi_name() !== 'cli') {
    exit;
}

/**
 * Class Task completion status values
 *
 * @since 1.1.0
 */
enum TaskStatus: string
{
    case OPEN = 'open';
    case COMPLETED = 'completed';

    /**
     * Human-readable label for display
     */
    public function label(): string
    {
        return match($this) {
            self::OPEN => 'Open',
            self::COMPLETED => 'Completed',
        };
    }

    /**
     * CSS class for badge styling
     */
    public function badgeClass(): string
    {
        return match($this) {
            self::OPEN => 'badge-warning',
            self::COMPLETED => 'badge-success',
        };
    }

    /**
     * Icon for display
     */
    public function icon(): string
    {
        return match($this) {
            self::OPEN => 'circle',
            self::COMPLETED => 'check-circle',
        };
    }

    /**
     * Safe conversion from string with fallback
     */
    public static function tryFromString(?string $value, self $default = self::OPEN): self
    {
        if ($value === null) {
            return $default;
        }
        return self::tryFrom($value) ?? $default;
    }
}
```

After creating TaskStatus, verify all three enums work together:

```php
// test-enums.php (temporary)
require_once __DIR__ . '/vendor/autoload.php';

use WeCoza\Events\Enums\SummaryStatus;
use WeCoza\Events\Enums\TaskStatus;
use WeCoza\Learners\Enums\ProgressionStatus;

// Test SummaryStatus
assert(SummaryStatus::SUCCESS->value === 'success');
assert(SummaryStatus::tryFromString('invalid') === SummaryStatus::PENDING);

// Test ProgressionStatus
assert(ProgressionStatus::IN_PROGRESS->isActive() === true);
assert(ProgressionStatus::COMPLETED->isActive() === false);

// Test TaskStatus
assert(TaskStatus::OPEN->value === 'open');
assert(TaskStatus::COMPLETED->label() === 'Completed');

echo "All enums verified successfully!\n";
```

Run and delete the test script.

**IMPORTANT:** Do NOT integrate these enums into existing models/services yet. That's Plan 03's job. This plan only creates the enum classes.
  </action>
  <verify>
```bash
php -l src/Events/Enums/TaskStatus.php
php test-enums.php && rm test-enums.php

# Verify all enum files exist
ls -la src/Events/Enums/
ls -la src/Learners/Enums/
```
  </verify>
  <done>All three enums created, each with label(), tryFromString(), and domain-specific helper methods. All pass syntax and functional verification.</done>
</task>

</tasks>

<verification>
All phase 10 plan 02 checks:
- [ ] Three enum files exist in appropriate Enums/ directories
- [ ] All use `enum Name: string` backed enum syntax
- [ ] SummaryStatus has PENDING, SUCCESS, FAILED cases
- [ ] ProgressionStatus has IN_PROGRESS, COMPLETED, ON_HOLD cases
- [ ] TaskStatus has OPEN, COMPLETED cases
- [ ] All have label() method for human-readable display
- [ ] All have tryFromString() for safe conversion with fallback
- [ ] All files pass PHP syntax check (php -l)
- [ ] String values match existing database values exactly
</verification>

<success_criteria>
- Three enum classes created (SummaryStatus, ProgressionStatus, TaskStatus)
- All use PHP 8.1 backed string enum syntax
- Each has label() for display and tryFromString() for safe validation
- ProgressionStatus has domain helpers (isActive, canLogHours, badgeClass)
- String values (pending, success, in_progress, etc.) match existing database values
- All files pass PHP syntax validation
</success_criteria>

<output>
After completion, create `.planning/phases/10-architecture-type-safety/10-02-SUMMARY.md`
</output>
