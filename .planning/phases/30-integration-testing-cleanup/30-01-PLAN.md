---
phase: 30-integration-testing-cleanup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Existing feature parity test passes with integrated module loaded"
    - "Standalone wecoza-agents-plugin deactivated without PHP errors"
    - "All agent pages render correctly after deactivation"
    - "All AJAX endpoints respond correctly after deactivation"
  artifacts:
    - path: "tests/integration/agents-feature-parity.php"
      provides: "Existing 607-line feature parity test script (from Phase 29)"
      contains: "AgentsParityTest"
  key_links:
    - from: "tests/integration/agents-feature-parity.php"
      to: "src/Agents/Controllers/AgentsController.php"
      via: "shortcode_exists() checks"
      pattern: "shortcode_exists"
    - from: "tests/integration/agents-feature-parity.php"
      to: "src/Agents/Ajax/AgentsAjaxHandlers.php"
      via: "wp_filter AJAX hook checks"
      pattern: "wp_filter.*wp_ajax_wecoza_agents_"
---

<objective>
Run existing feature parity test to confirm integrated Agents module is fully operational, then deactivate standalone wecoza-agents-plugin and verify zero breakage.

Purpose: Satisfies CLN-01 -- standalone plugin can be deactivated after migration verified. Test script already exists from Phase 29 (607 lines, 22/24 checks pass).
Output: Human-verified deactivation confirmation. No new files created.
</objective>

<execution_context>
@/home/laudes/.claude/get-shit-done/workflows/execute-plan.md
@/home/laudes/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/29-feature-verification/29-VERIFICATION.md
@tests/integration/agents-feature-parity.php
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run pre-deactivation safety checks</name>
  <files></files>
  <action>
Run a series of pre-deactivation verification checks. No files are created or modified -- this is purely verification.

**Step 1: Run existing feature parity test**

```bash
cd /opt/lampp/htdocs/wecoza && php wp-content/plugins/wecoza-core/tests/integration/agents-feature-parity.php
```

Expected: All checks pass except 2 expected failures (agent_meta table missing -- FEAT-02 not implemented). Exit code 0 or 1 (1 is acceptable for expected agent_meta failures).

**Step 2: Verify integrated module classes loaded**

Check these classes exist via PHP:
- `\WeCoza\Agents\Controllers\AgentsController`
- `\WeCoza\Agents\Ajax\AgentsAjaxHandlers`
- `\WeCoza\Agents\Repositories\AgentRepository`
- `\WeCoza\Agents\Models\AgentModel`
- `\WeCoza\Agents\Helpers\FormHelpers`
- `\WeCoza\Agents\Helpers\ValidationHelper`
- `\WeCoza\Agents\Services\WorkingAreasService`

**Step 3: Verify shortcodes registered**

```bash
cd /opt/lampp/htdocs/wecoza && wp eval 'foreach(["wecoza_capture_agents","wecoza_display_agents","wecoza_single_agent"] as $s) echo shortcode_exists($s)?"OK: $s\n":"FAIL: $s\n";'
```

Expected: All 3 shortcodes report OK.

**Step 4: Check debug.log baseline**

```bash
tail -20 /opt/lampp/htdocs/wecoza/wp-content/debug.log
```

Note any existing agent-related errors as baseline (before deactivation).

**Step 5: Check standalone plugin status**

Check if standalone wecoza-agents-plugin is currently active or already inactive. Document status.

If ANY unexpected failure occurs (not the expected agent_meta failures), STOP and document the issue. Do NOT proceed to deactivation.
  </action>
  <verify>
Feature parity test completes with only expected failures (agent_meta). All 7 classes loadable. All 3 shortcodes registered. Debug.log baseline captured.
  </verify>
  <done>Pre-deactivation safety checks pass. Integrated module confirmed operational. Ready for standalone plugin deactivation.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Deactivate standalone plugin and verify no breakage</name>
  <what-built>
Pre-deactivation safety checks confirm the integrated Agents module in wecoza-core provides all 3 shortcodes, 2 AJAX endpoints, 7 classes, 4 database tables (3 queryable + agent_meta expected missing), and 6 view templates. The integrated module is fully operational.
  </what-built>
  <how-to-verify>
1. Go to WordPress admin > Plugins page
2. Find "WeCoza Agents Plugin" (standalone) and click "Deactivate"
   - If already inactive, skip to step 3
3. Navigate to agent capture form page -- verify it renders correctly (no PHP errors)
4. Navigate to agents display/list page -- verify it renders correctly with statistics badges
5. Navigate to single agent view page -- verify it renders correctly
6. Try creating or editing an agent via the form -- verify AJAX save works
7. Verify pagination works on the display page
8. Check debug.log for any NEW agent-related errors:
   `tail -50 /opt/lampp/htdocs/wecoza/wp-content/debug.log`
9. Re-run feature parity test from CLI:
   `cd /opt/lampp/htdocs/wecoza && php wp-content/plugins/wecoza-core/tests/integration/agents-feature-parity.php`
10. Confirm test results are same as pre-deactivation (only agent_meta expected failures)
11. If any issues found: reactivate standalone plugin and note the issue
  </how-to-verify>
  <resume-signal>Type "approved" if all pages render and AJAX works without standalone plugin, or describe issues found.</resume-signal>
</task>

</tasks>

<verification>
- Feature parity test runs and reports same results as Phase 29 (22/24 pass)
- Standalone plugin successfully deactivated without breaking functionality
- All 3 agent shortcode pages render correctly
- AJAX operations (pagination, delete) work correctly
- No new PHP errors in debug.log after deactivation
</verification>

<success_criteria>
- CLN-01 satisfied: Standalone wecoza-agents-plugin deactivated without breaking any functionality
- All 3 shortcodes render via integrated module only
- Both AJAX endpoints respond via integrated module only
- Feature parity test passes with standalone plugin inactive
</success_criteria>

<output>
After completion, create `.planning/phases/30-integration-testing-cleanup/30-01-SUMMARY.md`
</output>
