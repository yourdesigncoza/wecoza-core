---
phase: 30-integration-testing-cleanup
plan: 02
type: execute
wave: 2
depends_on: ["30-01"]
files_modified:
  - .integrate/wecoza-agents-plugin/  # removal
autonomous: true

must_haves:
  truths:
    - "Zero WeCoza\\Agents\\Database\\DatabaseService references in wecoza-core active code"
    - "Zero WECOZA_AGENTS_* constant references in wecoza-core active code"
    - "Zero .integrate/ path references in wecoza-core active code"
    - "Zero wecoza-agents-plugin string references in wecoza-core active code"
    - ".integrate/wecoza-agents-plugin/ removed from repository"
    - "Integrated Agents module still functions after source removal"
  artifacts:
    - path: "src/Agents/"
      provides: "Integrated Agents module (intact after cleanup)"
    - path: "views/agents/"
      provides: "Agent view templates (intact after cleanup)"
    - path: "assets/js/agents/"
      provides: "Agent JS assets (intact after cleanup)"
  key_links:
    - from: "src/Agents/"
      to: "wecoza-core.php"
      via: "PSR-4 autoloading and controller instantiation"
      pattern: "WeCoza\\\\Agents"
    - from: "tests/integration/agents-feature-parity.php"
      to: "src/Agents/"
      via: "class_exists and shortcode_exists checks"
      pattern: "class_exists.*WeCoza"
---

<objective>
Detect and verify no dangling references to standalone plugin, remove `.integrate/wecoza-agents-plugin/` source directory, and confirm integrated module still functions post-cleanup.

Purpose: Satisfies CLN-02 -- `.integrate/wecoza-agents-plugin/` removed, zero standalone references in wecoza-core. Establishes single source of truth in `src/Agents/`.
Output: Clean repository with no standalone plugin artifacts.
</objective>

<execution_context>
@/home/laudes/.claude/get-shit-done/workflows/execute-plan.md
@/home/laudes/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/30-integration-testing-cleanup/30-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Dangling reference detection and source removal</name>
  <files>.integrate/wecoza-agents-plugin/</files>
  <action>
**Step 1: Pre-removal reference scans**

Run these 4 checks to confirm no active code depends on the standalone plugin:

1. Search for `WeCoza\Agents\Database\DatabaseService` references in active code:
   ```bash
   grep -r "WeCoza\\\\Agents\\\\Database\\\\DatabaseService" src/Agents/ views/agents/ --include="*.php"
   ```
   Expected: No matches.

2. Search for `WECOZA_AGENTS_` constants in active code:
   ```bash
   grep -r "WECOZA_AGENTS_" src/Agents/ views/agents/ assets/js/agents/ --include="*.php" --include="*.js"
   ```
   Expected: No matches.

3. Search for `.integrate/` path references in active code (excluding .planning/ and .git/):
   ```bash
   grep -r "\.integrate/" src/ views/ assets/ config/ wecoza-core.php --include="*.php" --include="*.js"
   ```
   Expected: No matches.

4. Search for `wecoza-agents-plugin` string in active code:
   ```bash
   grep -r "wecoza-agents-plugin" src/ views/ assets/ config/ wecoza-core.php composer.json --include="*.php" --include="*.js" --include="*.json"
   ```
   Expected: No matches.

If ANY check finds references, document them and fix before proceeding. Do NOT remove source if references exist.

**Step 2: Remove standalone plugin source**

If ALL 4 checks pass (no references found):
```bash
rm -rf .integrate/wecoza-agents-plugin/
```

If `.integrate/` directory is now empty, remove it too:
```bash
rmdir .integrate/ 2>/dev/null
```
(Only succeeds if empty -- safe to run regardless.)

**Step 3: Post-removal verification**

1. Verify folder removed:
   ```bash
   ls .integrate/wecoza-agents-plugin/ 2>&1
   ```
   Expected: "No such file or directory"

2. Verify src/Agents/ still intact:
   ```bash
   find src/Agents/ -name "*.php" | wc -l
   ```
   Expected: 7+ PHP files.

3. Run feature parity test:
   ```bash
   cd /opt/lampp/htdocs/wecoza && php wp-content/plugins/wecoza-core/tests/integration/agents-feature-parity.php
   ```
   Expected: Same results as before removal (22/24 pass, only agent_meta expected failures).

4. Verify git status shows clean deletion:
   ```bash
   git status --short .integrate/
   ```

If post-removal test fails unexpectedly, investigate immediately. The removal should have ZERO impact on the integrated module since no active code references `.integrate/`.
  </action>
  <verify>
1. `ls .integrate/wecoza-agents-plugin/ 2>&1` shows "No such file or directory"
2. `find src/Agents/ -name "*.php" | wc -l` shows 7+ files
3. Feature parity test passes with same results as pre-removal
4. `git status` shows clean deletion of .integrate/ contents
  </verify>
  <done>Standalone plugin source removed from repository. No dangling references. Integrated module still fully functional. Feature parity test confirms continued functionality.</done>
</task>

<task type="auto">
  <name>Task 2: Update project state and final verification</name>
  <files>.planning/STATE.md, .planning/PROJECT.md</files>
  <action>
**Step 1: Update STATE.md**

Update STATE.md to reflect Phase 30 completion:

1. Change "Current Position" to:
   - Phase: 30 of 30 (Integration Testing & Cleanup)
   - Plan: 2 of 2 complete
   - Status: Complete
   - Last activity: 2026-02-12 -- Phase 30 complete (Integration Testing & Cleanup)
   - Progress: 100% (30 phases complete)

2. Update v3.0 milestone in Milestone History:
   - Mark as shipped with today's date

3. Remove the v3.0 migration blockers/concerns that are now resolved:
   - "DatabaseService.update/delete signatures differ" -- RESOLVED (no more standalone)
   - "Duplicate helper methods in controller/AJAX handler" -- documented, standalone removed
   - Remove `.integrate/wecoza-agents-plugin/` related concerns

4. Update Session Continuity:
   - Stopped at: Phase 30 complete -- v3.0 Agents Integration milestone shipped
   - Resume file: .planning/phases/30-integration-testing-cleanup/30-02-SUMMARY.md
   - Next action: v3.0 Agents Integration complete. All milestones shipped.

**Step 2: Update PROJECT.md**

Update PROJECT.md to reflect v3.0 completion:
- Mark v3.0 Agents Integration as shipped
- Note standalone plugin deactivated and source removed

**Step 3: Final integration checklist**

Verify these truths hold simultaneously:
1. `src/Agents/` directory exists with all module files (Ajax, Controllers, Helpers, Models, Repositories, Services)
2. `views/agents/` directory exists with all 6 view templates
3. `assets/js/agents/` directory exists with all 5 JS files
4. `wecoza-core.php` references `WeCoza\Agents\` namespace (autoloading + initialization)
5. Feature parity test passes
6. `.integrate/wecoza-agents-plugin/` removed
7. No dangling references in codebase
8. Standalone plugin deactivated

Log the final checklist results in the SUMMARY.
  </action>
  <verify>
1. STATE.md updated with Phase 30 complete and v3.0 shipped
2. PROJECT.md updated with v3.0 shipped
3. All 8 final checklist items verified true
  </verify>
  <done>Project state updated. v3.0 Agents Integration milestone marked as shipped. All documentation reflects final state.</done>
</task>

</tasks>

<verification>
- `.integrate/wecoza-agents-plugin/` directory no longer exists
- No code references to `DatabaseService`, `WECOZA_AGENTS_*`, `.integrate/`, or `wecoza-agents-plugin` in active code
- Feature parity test still passes after removal
- `git status` shows clean state
- STATE.md and PROJECT.md updated to reflect v3.0 shipped
</verification>

<success_criteria>
- CLN-02 satisfied: `.integrate/wecoza-agents-plugin/` removed from repository
- Repository has single source of truth for Agents module in `src/Agents/`
- No dangling references to standalone plugin anywhere in active code
- Feature parity test confirms continued functionality post-cleanup
- v3.0 Agents Integration milestone documented as shipped
</success_criteria>

<output>
After completion, create `.planning/phases/30-integration-testing-cleanup/30-02-SUMMARY.md`
</output>
