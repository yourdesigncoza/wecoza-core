---
phase: 41-architectural-verification
plan: 02
type: execute
wave: 2
depends_on: ["41-01"]
files_modified:
  - .planning/phases/41-architectural-verification/41-02-SUMMARY.md
autonomous: false

must_haves:
  truths:
    - "Debug log contains zero new PHP warnings/notices/fatals from refactored wecoza-core files"
    - "Every FAIL or MANUAL result from Plan 01 has a documented disposition (genuine gap, false positive, or acceptable deviation)"
    - "User confirms learner, agent, client, and class pages load without errors"
    - "User confirms agent detail pages display addresses correctly (ADDR-05)"
    - "v4.0 milestone status is definitively READY or NEEDS GAP CLOSURE"
  artifacts:
    - path: ".planning/phases/41-architectural-verification/41-02-SUMMARY.md"
      provides: "Final verification report with integration test results"
  key_links:
    - from: "wp-content/debug.log"
      to: "wecoza-core plugin"
      via: "WordPress error logging"
      pattern: "PHP Warning|PHP Notice|PHP Fatal"
---

<objective>
Perform integration-level verification: check WordPress debug log for regressions, verify shortcodes render correctly, and confirm address migration integrity. Address any gaps identified in Plan 01.

Purpose: Ensure the architectural refactoring introduced zero regressions in the live WordPress environment.
Output: Final verification report confirming v4.0 milestone readiness.
</objective>

<execution_context>
@/home/laudes/.claude/get-shit-done/workflows/execute-plan.md
@/home/laudes/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/41-architectural-verification/41-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Check WordPress debug log for regressions</name>
  <files>.planning/phases/41-architectural-verification/41-02-SUMMARY.md</files>
  <action>
Read the WordPress debug log at `/opt/lampp/htdocs/wecoza/wp-content/debug.log`.

Search for any PHP warnings, notices, or fatal errors that reference wecoza-core plugin files:
- `wecoza-core` in the file path
- `WeCoza\\` in the error namespace
- Any of the refactored files (Services, Models, Repositories, Controllers)

Focus on RECENT entries (last 24 hours or since the refactoring work on 2026-02-16). Look for:
1. **Fatal errors** -- These would indicate broken functionality
2. **Warnings** -- Type mismatches, undefined methods, missing arguments
3. **Notices** -- Undefined variables, deprecated usage
4. **Deprecation notices** -- PHP 8.x deprecation warnings

Document each finding with:
- Error type (Fatal/Warning/Notice)
- File and line number
- Error message
- Which requirement it relates to (if any)
- Assessment: regression from v4.0 work or pre-existing?

If the debug log is very large, focus on entries from 2026-02-16 onwards.
  </action>
  <verify>Debug log analysis complete. All wecoza-core errors documented with severity assessment.</verify>
  <done>Zero new PHP warnings/notices/fatals from wecoza-core refactored files, OR all findings documented with severity and requirement impact.</done>
</task>

<task type="auto">
  <name>Task 2: Review Plan 01 results and document gap analysis</name>
  <files>.planning/phases/41-architectural-verification/41-02-SUMMARY.md</files>
  <action>
Read the Plan 01 SUMMARY at `.planning/phases/41-architectural-verification/41-01-SUMMARY.md`.

**Structured investigation procedure for each non-PASS result:**

1. **Identify:** List every requirement marked FAIL or MANUAL CHECK REQUIRED from Plan 01.
2. **For each FAIL result:**
   a. Read the specific source file(s) referenced in the failure report
   b. Compare against the requirement definition (from ROADMAP.md or design doc)
   c. Classify as one of:
      - **Genuine gap:** Code does not meet requirement. Document: what is missing, which file(s) need changes, estimated fix scope.
      - **False positive:** Verification script was too strict. Document: what the actual state is, why it satisfies the requirement, suggest script adjustment.
      - **Acceptable deviation:** Requirement was met via alternative approach. Document: the alternative approach and why it is acceptable.
   d. Record the classification and evidence (file path, line numbers, code snippet)
3. **For ADDR-05 (MANUAL CHECK REQUIRED):**
   - Document that this requires user verification in Task 3 checkpoint
   - Note what the user should check: agent detail pages should show addresses, locations table should have agent address records
4. **Consolidate findings into final report:**
   - Table of all 28 requirements with final disposition
   - Debug log findings from Task 1
   - Gap list (if any genuine gaps exist)
   - Final v4.0 milestone assessment: READY or NEEDS GAP CLOSURE with specific items

If all 28 requirements pass (or have documented justification for acceptable deviations), recommend marking v4.0 as complete.
  </action>
  <verify>Gap analysis covers every non-PASS result from Plan 01. Each has a classification (genuine gap, false positive, acceptable deviation) with evidence.</verify>
  <done>Consolidated verification report exists with clear v4.0 milestone status. All 28 requirements have a final disposition (PASS, ACCEPTABLE DEVIATION, or NEEDS FIX).</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: User verifies live site has no regressions</name>
  <files>.planning/phases/41-architectural-verification/41-02-SUMMARY.md</files>
  <action>
User manually verifies the live WordPress site works correctly after all v4.0 refactoring.

What was built: Complete architectural verification of v4.0 refactoring -- 28 requirements checked via automated script + debug log analysis + gap review.

How to verify:

**A. Shortcode page rendering (Phase 41 Success Criteria #3):**
Visit each of these pages and confirm they load without PHP errors or blank screens:

1. **Learners module:** Visit pages containing these shortcodes:
   - `[wecoza_display_learners]` -- learner list page
   - `[wecoza_learners_form]` -- learner create form
   - `[wecoza_single_learner_display]` -- any individual learner
   - `[wecoza_learners_update_form]` -- learner edit form

2. **Agents module:** Visit pages containing these shortcodes:
   - `[wecoza_display_agents]` -- agent list page
   - `[wecoza_capture_agents]` -- agent create/edit form
   - `[wecoza_single_agent]` -- any individual agent detail page

3. **Clients module:** Visit pages containing these shortcodes:
   - `[wecoza_display_clients]` -- client list page
   - `[wecoza_capture_clients]` -- client create form
   - `[wecoza_update_clients]` -- client edit form
   - `[wecoza_locations_list]` -- locations list page

4. **Classes module:** Visit pages containing these shortcodes:
   - `[wecoza_display_classes]` -- class list page
   - `[wecoza_capture_class]` -- class create/edit form

**B. AJAX endpoint smoke test (Phase 41 Success Criteria #2):**
For each module, trigger one key AJAX action and confirm it responds:

1. **Learners:** On the learner list page, confirm the DataTable loads data (this triggers `fetch_learners_data` AJAX)
2. **Agents:** On the agents list page, confirm the DataTable loads agent rows (triggers `wecoza_agents_paginate` AJAX)
3. **Clients:** On the client list page, confirm the DataTable loads clients (triggers `wecoza_search_clients` or `wecoza_get_branch_clients` AJAX)
4. **Classes:** On the class list page, confirm classes display (triggers `get_calendar_events` or class data fetch)

**C. ADDR-05 data preservation verification (Phase 41 Success Criteria #4):**
1. Navigate to any agent detail page (`[wecoza_single_agent]`)
2. Confirm the agent's address information is displayed correctly
3. If available, check 2-3 different agents to confirm addresses show for all
4. Look specifically for: street address, city/town, province, postal code fields

**D. Debug log check:**
After visiting all the above pages, check `/opt/lampp/htdocs/wecoza/wp-content/debug.log` for any new PHP errors.

Resume signal: Type "approved" if all pages load correctly, AJAX data loads, agent addresses display, and no new debug log entries. Or describe any issues found.
  </action>
  <verify>User confirms all module pages load without errors, AJAX endpoints return data, agent addresses display correctly, and no new debug log entries appear.</verify>
  <done>User has approved the verification -- all module pages load correctly, AJAX endpoints respond, agent addresses display, no visible regressions, debug log clean.</done>
</task>

</tasks>

<verification>
1. WordPress debug log reviewed for wecoza-core regressions
2. All Plan 01 FAIL/MANUAL results investigated with structured procedure and documented
3. Final v4.0 milestone assessment produced
4. User confirms shortcode pages render across all 5 modules (checkpoint)
5. User confirms AJAX endpoints respond with data (checkpoint)
6. User confirms agent addresses display correctly on detail pages -- ADDR-05 (checkpoint)
</verification>

<success_criteria>
- Zero new PHP errors in debug log from refactored files
- All 28 requirements have final disposition
- User confirms all module pages load without errors
- User confirms AJAX DataTables load data in learner, agent, client, class modules
- User confirms agent addresses display on agent detail pages
- v4.0 milestone status is definitively READY or NEEDS GAP CLOSURE with specific items
</success_criteria>

<output>
After completion, create `.planning/phases/41-architectural-verification/41-02-SUMMARY.md`
</output>
