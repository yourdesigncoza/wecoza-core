---
phase: 52-class-activation-logic
plan: 04
type: execute
wave: 2
depends_on: [52-01]
files_modified:
  - views/classes/components/classes-display.view.php
  - views/classes/components/single-class/summary-cards.php
autonomous: true
requirements: [WEC-179]

must_haves:
  truths:
    - "Classes listing shows three-way badge: Draft (warning), Active (success), Stopped (danger)"
    - "Active count in summary strip excludes stopped classes"
    - "Single class display has a 6th summary card showing class status"
  artifacts:
    - path: "views/classes/components/classes-display.view.php"
      provides: "Three-way badge replacing binary order_nr check"
      contains: "wecoza_resolve_class_status"
    - path: "views/classes/components/single-class/summary-cards.php"
      provides: "6th status summary card"
      contains: "wecoza_resolve_class_status"
  key_links:
    - from: "views/classes/components/classes-display.view.php"
      to: "core/Helpers/functions.php"
      via: "wecoza_resolve_class_status() for badge rendering"
      pattern: "wecoza_resolve_class_status"
---

<objective>
Replace the binary Draft/Active badge in the classes listing with a three-way badge (Draft/Active/Stopped), and add a status summary card to the single class display page.

Purpose: Visual status awareness across the class listing (Q3:A) and single class detail views. Uses established Phoenix badge pattern with no new CSS.
Output: Updated listing view, new summary card.
</objective>

<execution_context>
@/home/laudes/.claude/get-shit-done/workflows/execute-plan.md
@/home/laudes/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/52-class-activation-logic/52-RESEARCH.md
@/home/laudes/.claude/plans/snoopy-wobbling-fountain.md

Key references:
- classes-display.view.php: views/classes/components/classes-display.view.php — binary badge at ~lines 270-285
- summary-cards.php: views/classes/components/single-class/summary-cards.php — 5 existing cards
- Research code example: three-way badge PHP pattern using match()
- Phoenix badge classes: badge-phoenix-success, badge-phoenix-warning, badge-phoenix-danger
</context>

<tasks>

<task type="auto">
  <name>Task 1: Three-way badge in classes listing + status summary card</name>
  <files>views/classes/components/classes-display.view.php, views/classes/components/single-class/summary-cards.php</files>
  <action>
**A. views/classes/components/classes-display.view.php** — Replace the binary badge logic (~lines 270-285):

Find the existing code that does `$isDraft = empty($class['order_nr'])` with if/else for Draft/Active badges. Replace with three-way using `wecoza_resolve_class_status()`:

```php
<?php
$classStatus = wecoza_resolve_class_status($class);
$badgeClass = match($classStatus) {
    'active'  => 'badge-phoenix-success',
    'stopped' => 'badge-phoenix-danger',
    default   => 'badge-phoenix-warning',
};
$badgeLabel = match($classStatus) {
    'active'  => __('Active', 'wecoza-core'),
    'stopped' => __('Stopped', 'wecoza-core'),
    default   => __('Draft', 'wecoza-core'),
};
$badgeIcon = match($classStatus) {
    'active'  => 'bi-check-circle',
    'stopped' => 'bi-stop-circle',
    default   => 'bi-file-earmark-text',
};
?>
<span class="badge badge-phoenix fs-10 <?= esc_attr($badgeClass); ?>">
    <span class="badge-label"><?= esc_html($badgeLabel); ?></span>
    <span class="<?= esc_attr($badgeIcon); ?> ms-1"></span>
</span>
```

Also update the active count in the summary strip (if one exists near the top of the listing) to exclude stopped classes. Look for any `$activeCount` or similar counter that currently counts `!empty(order_nr)` and update to also check `class_status !== 'stopped'` via the helper.

**B. views/classes/components/single-class/summary-cards.php** — Add 6th summary card for class status:

After the last existing card (Total Hours), add:
```php
<?php
$classStatus = wecoza_resolve_class_status($class);
$statusBadgeClass = match($classStatus) {
    'active'  => 'badge-phoenix-success',
    'stopped' => 'badge-phoenix-danger',
    default   => 'badge-phoenix-warning',
};
$statusLabel = match($classStatus) {
    'active'  => __('Active', 'wecoza-core'),
    'stopped' => __('Stopped', 'wecoza-core'),
    default   => __('Draft', 'wecoza-core'),
};
$statusIcon = match($classStatus) {
    'active'  => 'bi-check-circle-fill',
    'stopped' => 'bi-stop-circle-fill',
    default   => 'bi-file-earmark-text-fill',
};
?>
<div class="col-sm-6 col-md-4 col-xl-2">
    <div class="card h-100">
        <div class="card-body d-flex align-items-center gap-3">
            <span class="badge badge-phoenix fs-3 <?= esc_attr($statusBadgeClass); ?>">
                <i class="<?= esc_attr($statusIcon); ?>"></i>
            </span>
            <div>
                <p class="mb-0 text-body-tertiary fs-10"><?= esc_html__('Status', 'wecoza-core'); ?></p>
                <h5 class="mb-0"><?= esc_html($statusLabel); ?></h5>
            </div>
        </div>
    </div>
</div>
```
Follow the exact card structure used by the existing 5 cards (same Bootstrap column classes, same card-body layout with icon + label).

No CSS changes needed — all Phoenix badge classes already exist.
  </action>
  <verify>
    <automated>grep -q "wecoza_resolve_class_status" /opt/lampp/htdocs/wecoza/wp-content/plugins/wecoza-core/views/classes/components/classes-display.view.php && grep -q "wecoza_resolve_class_status" /opt/lampp/htdocs/wecoza/wp-content/plugins/wecoza-core/views/classes/components/single-class/summary-cards.php && echo "PASS" || echo "FAIL"</automated>
  </verify>
  <done>Classes listing shows Draft/Active/Stopped badges with correct Phoenix colors. Single class display has 6th summary card showing status. No new CSS added.</done>
</task>

</tasks>

<verification>
1. Classes listing renders Draft (yellow), Active (green), Stopped (red) badges correctly
2. A class with no order_nr shows Draft badge
3. A class with order_nr shows Active badge
4. A stopped class (after migration + manual status update) shows Stopped badge
5. Single class page has 6 summary cards with status as the 6th
6. No new CSS rules added — uses existing Phoenix badge classes
</verification>

<success_criteria>
- Three-way badge system visible on classes listing
- Status summary card on single class detail page
- Consistent visual language using Phoenix badge system
</success_criteria>

<output>
After completion, create `.planning/phases/52-class-activation-logic/52-04-SUMMARY.md`
</output>
