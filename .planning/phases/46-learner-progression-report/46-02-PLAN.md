---
phase: 46-learner-progression-report
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/Learners/Shortcodes/progression-report-shortcode.php
  - views/learners/progression-report.php
  - wecoza-core.php
autonomous: true
requirements: [RPT-01, RPT-03, RPT-05, RPT-06]

must_haves:
  truths:
    - "Shortcode [wecoza_learner_progression_report] renders without PHP errors"
    - "View contains search input for learner name/ID"
    - "View contains employer filter dropdown"
    - "View contains four Phoenix-styled summary cards"
    - "View contains results container for grouped learner timelines"
  artifacts:
    - path: "src/Learners/Shortcodes/progression-report-shortcode.php"
      provides: "Shortcode registration and script enqueue"
      contains: "wecoza_learner_progression_report"
    - path: "views/learners/progression-report.php"
      provides: "Report view template"
      contains: "progression-report-container"
    - path: "wecoza-core.php"
      provides: "Shortcode file require_once"
      contains: "progression-report-shortcode"
  key_links:
    - from: "src/Learners/Shortcodes/progression-report-shortcode.php"
      to: "views/learners/progression-report.php"
      via: "wecoza_view('learners/progression-report')"
      pattern: "wecoza_view.*progression-report"
    - from: "src/Learners/Shortcodes/progression-report-shortcode.php"
      to: "assets/js/learners/progression-report.js"
      via: "wp_enqueue_script"
      pattern: "wp_enqueue_script.*progression-report"
---

<objective>
Create shortcode and static view template for the learner progression report page.

Purpose: Register [wecoza_learner_progression_report] and build the HTML shell with Phoenix summary cards, search/filter controls, and results container that Plan 03 JS will populate.
Output: Shortcode file, view template, wecoza-core.php registration.
</objective>

<execution_context>
@/home/laudes/.claude/get-shit-done/workflows/execute-plan.md
@/home/laudes/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/Learners/Shortcodes/progression-admin-shortcode.php
@views/learners/progression-admin.php
@wecoza-core.php
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create shortcode file and register in wecoza-core.php</name>
  <files>
    src/Learners/Shortcodes/progression-report-shortcode.php
    wecoza-core.php
  </files>
  <action>
Create `src/Learners/Shortcodes/progression-report-shortcode.php` following the exact pattern of `progression-admin-shortcode.php`:

```php
<?php
declare(strict_types=1);

namespace WeCoza\Learners\Shortcodes;

if (!defined('ABSPATH')) {
    exit;
}

function wecoza_progression_report_shortcode(): string {
    wp_enqueue_script(
        'progression-report-script',
        WECOZA_CORE_URL . 'assets/js/learners/progression-report.js',
        ['jquery'],
        WECOZA_CORE_VERSION,
        true
    );

    wp_localize_script('progression-report-script', 'progressionReportAjax', [
        'ajaxurl' => admin_url('admin-ajax.php'),
        'nonce'   => wp_create_nonce('learners_nonce'),
    ]);

    ob_start();
    wecoza_view('learners/progression-report', []);
    return ob_get_clean();
}

add_shortcode('wecoza_learner_progression_report', __NAMESPACE__ . '\wecoza_progression_report_shortcode');
```

Then in `wecoza-core.php`, add the require_once AFTER the existing progression-admin-shortcode.php line:

```php
// Progression report shortcode [wecoza_learner_progression_report]
require_once WECOZA_CORE_PATH .
    "src/Learners/Shortcodes/progression-report-shortcode.php";
```
  </action>
  <verify>
grep -n "progression-report-shortcode" wecoza-core.php should show the require_once line.
grep -n "wecoza_learner_progression_report" src/Learners/Shortcodes/progression-report-shortcode.php should show the add_shortcode call.
  </verify>
  <done>
Shortcode file exists, enqueues progression-report.js with localized AJAX config, renders view via wecoza_view(), and is loaded via wecoza-core.php.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create progression report view template</name>
  <files>views/learners/progression-report.php</files>
  <action>
Create `views/learners/progression-report.php` with these sections:

1. **Container wrapper**: `<div id="progression-report-container">`

2. **Alert container**: `<div id="report-alert" class="alert-container"></div>`

3. **Loading spinner**: Same pattern as progression-admin.php -- centered spinner with "Loading report..." text, `id="report-loading"`.

4. **Main content** (`id="report-content"`, hidden via `style="display:none;"` until JS loads):

   a. **Header row**: Title "Learner Progression Report" with `bi-graph-up` icon.

   b. **Summary cards row** -- Four cards in a `row g-3 mb-3`:
      - Card 1 (col-md-3): "Total Learners" -- icon `bi-people`, value `<span id="stat-total-learners">0</span>`, subtitle "across all programmes". Use `card shadow-none border` with `card-body p-3`.
      - Card 2 (col-md-3): "Completion Rate" -- icon `bi-check-circle`, value `<span id="stat-completion-rate">0</span>%`, subtitle "of all progressions". Add `text-success` on icon.
      - Card 3 (col-md-3): "Avg. Progress" -- icon `bi-speedometer2`, value `<span id="stat-avg-progress">0</span>%`, subtitle "hours completed". Add `text-primary` on icon.
      - Card 4 (col-md-3): "Active LPs" -- icon `bi-book`, value `<span id="stat-active-lps">0</span>`, subtitle "currently in progress". Add `text-info` on icon.

      Each card layout: icon float-start me-3 (fs-3), value as `h4 mb-0`, subtitle as `text-muted fs-9`.

   c. **Filter card** -- `card shadow-none border mb-3` with `card-body p-3`:
      - Row with 3 columns:
        - col-md-5: Search input (`id="report-search"`, type="text", placeholder="Search by learner name or ID...", with `bi-search` icon prepend using `input-group`)
        - col-md-4: Employer filter (`id="report-employer-filter"`, select with "All Employers" default + empty options JS will populate)
        - col-md-3: Search button (`id="btn-report-search"`, "Search", `btn-phoenix-primary btn-sm w-100`)

   d. **Status filter pills** -- `<div id="report-status-pills" class="mb-3">` with Bootstrap nav-pills:
      - "All" (active, value=""), "In Progress" (value="in_progress"), "Completed" (value="completed"), "On Hold" (value="on_hold")
      - Use `<button>` elements with `data-status` attribute, class `btn btn-sm btn-phoenix-secondary me-1`, active gets `active` class.

   e. **Results container** (`id="report-results"`):
      - Empty div. JS will populate with company-grouped expandable accordion sections.
      - Each accordion section: company name header with learner count badge, expandable body with individual learner timeline rows.

   f. **Empty state** (`id="report-empty"`, hidden `d-none`): "No progressions found matching your criteria." with `bi-inbox` icon, centered text-muted.

5. Close container div.

Use Phoenix utility classes throughout: `fs-9` for small text, `badge badge-phoenix-*` for badges, `border` for card borders, `shadow-none` for flat cards. No custom CSS needed -- all Bootstrap/Phoenix utilities.
  </action>
  <verify>
grep -n "progression-report-container\|stat-total-learners\|report-search\|report-employer-filter\|report-results" views/learners/progression-report.php should show all key element IDs.
  </verify>
  <done>
View template exists with four summary stat cards, search input, employer dropdown filter, status pills, accordion-style results container, and empty state -- all using Phoenix/Bootstrap utility classes and IDs matching what Plan 03 JS will target.
  </done>
</task>

</tasks>

<verification>
1. Shortcode renders without PHP errors (wecoza_view path resolves)
2. Summary cards have distinct IDs (stat-total-learners, stat-completion-rate, stat-avg-progress, stat-active-lps)
3. Filter controls have IDs (report-search, report-employer-filter, btn-report-search)
4. Results container (report-results) and empty state (report-empty) are present
5. Script enqueue references progression-report.js
</verification>

<success_criteria>
- `[wecoza_learner_progression_report]` shortcode is registered and renders the view without errors
- View HTML contains all four summary cards, search input, employer filter, status pills, and results container
- progression-report.js is enqueued with ajaxurl and nonce localized
</success_criteria>

<output>
After completion, create `.planning/phases/46-learner-progression-report/46-02-SUMMARY.md`
</output>
