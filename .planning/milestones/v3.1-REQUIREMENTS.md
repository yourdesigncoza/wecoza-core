# Requirements Archive: v3.1 Form Field Wiring Fixes

**Archived:** 2026-02-13
**Status:** ✅ SHIPPED

For current requirements, see `.planning/REQUIREMENTS.md`.

---

## v3.1 Requirements

### Learners Module (LRNR)

- [x] **LRNR-01**: Fix `numeracy_level` missing from update shortcode POST processing — already fixed in e47bc30
- [x] **LRNR-02**: Resolve `sponsors[]` orphaned field — verified fully implemented, not orphaned
- [x] **LRNR-03**: Clean up phantom fields — verified already correct, no phantom fields in docs or repo
- [x] **LRNR-04**: Remove duplicate `placement_assessment_date` field — already fixed in e47bc30
- [x] **LRNR-05**: Remove `nopriv` AJAX registrations — already fixed in e47bc30
- [x] **LRNR-06**: Fix `employment_status` initial visibility bug — already fixed in e47bc30
- [x] **LRNR-07**: Use `intval()` for `highest_qualification` FK ID — already fixed in e47bc30
- [x] **LRNR-08**: Add date format validation for `placement_assessment_date` — already fixed in e47bc30
- [x] **LRNR-09**: Fix template literal XSS risk — FIXED in 31-02 (commit 8e1d5ec)
- [x] **LRNR-10**: Clean up dead code — FIXED in 31-02 (legacy template deleted)

### Classes Module (CLS)

- [x] **CLS-01**: Fix `order_nr` reverse path — FIXED in 32-01 (commit 09c696e)
- [x] **CLS-02**: Set `class_agent` from `initial_class_agent` on create — FIXED in 32-01 (commit 84c5804)
- [x] **CLS-03**: Remove `nopriv` from QA write endpoints — FIXED in 32-01 (commit 09c696e)
- [x] **CLS-04**: Sanitize `stop_dates[]`/`restart_dates[]` with validation — FIXED in 32-01 (commit 84c5804)
- [x] **CLS-05**: Type-cast `site_id` with `intval()` — FIXED in 32-01 (commit 84c5804)
- [x] **CLS-06**: Sanitize `learner_ids`/`exam_learners` per-entry — FIXED in 32-01 (commit 84c5804)
- [x] **CLS-07**: Fix `initial_class_agent` pre-selection — FIXED in 32-01 (commit 09c696e)
- [x] **CLS-08**: Migrate agents/supervisors from static arrays to DB queries — FIXED in 32-02 (commit cf1e74b)
- [x] **CLS-09**: Validate `backup_agent_dates[]` as valid date format — FIXED in 32-01 (commit 84c5804)

### Agents Module (AGT)

- [x] **AGT-01**: Fix `postal_code` → `residential_postal_code` mapping — verified already fixed in v3.0 migration
- [x] **AGT-02**: Add server-side validation for 14 HTML-required fields — FIXED in 33-01 (commit 09b35f8)
- [x] **AGT-03**: Sanitize `preferred_working_area_1/2/3` with `absint()` — FIXED in 33-01 (commit 09b35f8)
- [x] **AGT-04**: Remove `agent_notes` from agents table insert/update whitelist — FIXED in 33-01 (commit 7c4a20b)
- [x] **AGT-05**: Remove `residential_town_id` from insert whitelist — FIXED in 33-01 (commit 7c4a20b)
- [x] **AGT-06**: Extract shared display methods into shared service (DRY) — FIXED in 33-02 (commits 040cfa1, 0a817ea)

### Clients Module (CLT)

- [x] **CLT-01**: Remove inline submit handler from update form — FIXED in 34-01 (commit e4d01ed)
- [x] **CLT-02**: Add `wp_nonce_field()` to capture form — FIXED in 34-01 (commit e4d01ed)
- [x] **CLT-03**: Remove `client_town_id` from repository whitelists — FIXED in 34-01 (commit 956be70)
- [x] **CLT-04**: Unify nonce action strings to `clients_nonce_action` — FIXED in 34-01 (commit e4d01ed)
- [x] **CLT-05**: Remove 7 unused AJAX endpoints — FIXED in 34-01 (commit 956be70)

### Events Module (EVT)

- [x] **EVT-01**: Add late escaping for `summary_html` output — FIXED in 35-01 (commit ef4f773)
- [x] **EVT-02**: Add late escaping for `notification_badge_html`/`status_badge_html` — FIXED in 35-01 (commit ef4f773)
- [x] **EVT-03**: Update `markDelivered()` to sync tracking table — FIXED in 35-01 (commit 451806f)
- [x] **EVT-04**: Remove duplicate test notification JS — FIXED in 35-01 (commit 451806f)

## Future Requirements (Deferred)

### Learners
- **LRNR-F01**: Implement sponsor persistence (new `learner_sponsors` table + POST processing)
- **LRNR-F02**: Province → city → suburb cascade (like Clients module)

### Classes
- **CLS-F01**: Investigate `order_nr_metadata` orphaned JSONB column
- **CLS-F02**: Implement `class_agent` update mechanism when agent replacements processed

---

## Traceability

| Requirement | Phase | Plan | Status | Commit |
|-------------|-------|------|--------|--------|
| LRNR-01 | 31 | 01 | Complete | e47bc30 |
| LRNR-02 | 31 | 01 | Complete | e47bc30 |
| LRNR-03 | 31 | 02 | Complete | Already correct |
| LRNR-04 | 31 | 01 | Complete | e47bc30 |
| LRNR-05 | 31 | 01 | Complete | e47bc30 |
| LRNR-06 | 31 | 01 | Complete | e47bc30 |
| LRNR-07 | 31 | 01 | Complete | e47bc30 |
| LRNR-08 | 31 | 01 | Complete | e47bc30 |
| LRNR-09 | 31 | 02 | Complete | 8e1d5ec |
| LRNR-10 | 31 | 02 | Complete | Untracked file |
| CLS-01 | 32 | 01 | Complete | 09c696e |
| CLS-02 | 32 | 01 | Complete | 84c5804 |
| CLS-03 | 32 | 01 | Complete | 09c696e |
| CLS-04 | 32 | 01 | Complete | 84c5804 |
| CLS-05 | 32 | 01 | Complete | 84c5804 |
| CLS-06 | 32 | 01 | Complete | 84c5804 |
| CLS-07 | 32 | 01 | Complete | 09c696e |
| CLS-08 | 32 | 02 | Complete | cf1e74b |
| CLS-09 | 32 | 01 | Complete | 84c5804 |
| AGT-01 | 33 | 01 | Complete | Already fixed |
| AGT-02 | 33 | 01 | Complete | 09b35f8 |
| AGT-03 | 33 | 01 | Complete | 09b35f8 |
| AGT-04 | 33 | 01 | Complete | 7c4a20b |
| AGT-05 | 33 | 01 | Complete | 7c4a20b |
| AGT-06 | 33 | 02 | Complete | 040cfa1, 0a817ea |
| CLT-01 | 34 | 01 | Complete | e4d01ed |
| CLT-02 | 34 | 01 | Complete | e4d01ed |
| CLT-03 | 34 | 01 | Complete | 956be70 |
| CLT-04 | 34 | 01 | Complete | e4d01ed |
| CLT-05 | 34 | 01 | Complete | 956be70 |
| EVT-01 | 35 | 01 | Complete | ef4f773 |
| EVT-02 | 35 | 01 | Complete | ef4f773 |
| EVT-03 | 35 | 01 | Complete | 451806f |
| EVT-04 | 35 | 01 | Complete | 451806f |

---

## Milestone Summary

**Shipped:** 34 of 34 requirements
**Adjusted:** LRNR-02 (sponsors not orphaned, verified fully implemented), LRNR-03 (already correct, no phantom fields)
**Dropped:** 0

---
*Archived: 2026-02-13 as part of v3.1 milestone completion*
